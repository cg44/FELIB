      SUBROUTINE TR6FN(FUN, IFUN, DER, IDER, JDER, XI, ETA, ITEST)
      INTEGER IDER, IFUN, ITEST, JDER,ERRMES,IERROR
      DOUBLE PRECISION DER, ETA, FUN, L1, L2, L3, XI,
     *     Y1,Y2,SRNAME
      DIMENSION DER(IDER,JDER), FUN(IFUN)
      DATA SRNAME /8H TR6FN  /
      IF(ITEST.EQ.-1) GO TO 999
      IERROR=0
      IF(IFUN.LT.6) IERROR=1
      IF(IDER.LT.2.OR.JDER.LT.6) IERROR=2
      Y1=1.0D0/DSQRT(3.0D0)*(XI-1.0D0)
      Y2=1.0D0/DSQRT(3.0D0)*(1.0D0-XI)
      IF((XI.LT.-0.5D0.OR.XI.GT.1.0D0).OR.
     *     (ETA.LT.Y1.OR.ETA.GT.Y2)) IERROR=3
      ITEST=ERRMES(ITEST,IERROR,SRNAME)
      IF(ITEST.NE.0) RETURN
999   L1 = 1.0D0/3.0D0*(1.0D0+2.0D0*XI)
      L2 = 1.0D0/3.0D0*(1.0D0-XI-DSQRT(3.0D0)*ETA)
      L3 = 1.0D0/3.0D0*(1.0D0-XI+DSQRT(3.0D0)*ETA)
      FUN(1) = (2.0D0*L1-1.0D0)*L1
      FUN(2) = 4.0D0*L1*L2
      FUN(3) = (2.0D0*L2-1.0D0)*L2
      FUN(4) = 4.0D0*L2*L3
      FUN(5) = (2.0D0*L3-1.0D0)*L3
      FUN(6) = 4.0D0*L3*L1
      DER(1,1) = 2.0D0/3.0D0*(4.0D0*L1-1.0D0)
      DER(1,2) = 4.0D0/3.0D0*(2.0D0*L2-L1)
      DER(1,3) = -1.0D0/3.0D0*(4.0D0*L2-1.0D0)
      DER(1,4) = -4.0D0/3.0D0*(L2+L3)
      DER(1,5) = -1.0D0/3.0D0*(4.0D0*L3-1.0D0)
      DER(1,6) = 4.0D0/3.0D0*(2.0D0*L3-L1)
      DER(2,1) = 0.0D0
      DER(2,2) = -4.0D0/DSQRT(3.0D0)*L1
      DER(2,3) = -1.0D0/DSQRT(3.0D0)*(4.0D0*L2-1.0D0)
      DER(2,4) = 4.0D0/DSQRT(3.0D0)*(L2-L3)
      DER(2,5) = 1.0D0/DSQRT(3.0D0)*(4.0D0*L3-1.0D0)
      DER(2,6) = 4.0D0/DSQRT(3.0D0)*L1
      RETURN
      END
