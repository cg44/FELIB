      SUBROUTINE FORMNF(NFDAT, INFDAT, JNFDAT, RN, NN, DOFNOD, NF,
     *     INF, JNF, TOTDOF, ITEST)
      INTEGER DOFNOD, I, INF, J, K, L, NF, NFDAT, NN, RN, TOTDOF,
     *     IERROR,ERRMES
      DOUBLE PRECISION SRNAME
      DIMENSION NF(INF,JNF), NFDAT(INFDAT,JNFDAT)
      DATA SRNAME /8H FORMNF /
      IF(ITEST.EQ.-1) GO TO 999
      IERROR=0
      IF(INF.LT.NN.OR.JNF.LT.DOFNOD) IERROR=3
      IF(INFDAT.LT.RN.OR.JNFDAT.LT.DOFNOD+1) IERROR=2
      IF(RN.LE.0.OR.NN.LE.0.OR.DOFNOD.LE.0) IERROR=1
      ITEST=ERRMES(ITEST,IERROR,SRNAME)
      IF(ITEST.NE.0) RETURN
999   DO 1020 I=1,NN
      DO 1010 J=1,DOFNOD
      NF(I,J) = 1
 1010 CONTINUE
 1020 CONTINUE
      DO 1040 I=1,RN
      K = NFDAT(I,1)
      DO 1030 J=1,DOFNOD
      L = NFDAT(I,J+1)
      IF(ITEST.EQ.-1) GO TO 888
      IERROR=0
      IF(K.GT.NN.OR.L.GT.DOFNOD) IERROR=4
      ITEST=ERRMES(ITEST,IERROR,SRNAME)
      IF(ITEST.NE.0) RETURN
888   IF (L.NE.0) NF(K,L) = 0
 1030 CONTINUE
 1040 CONTINUE
      K = 1
      DO 1060 I=1,NN
      DO 1050 J=1,DOFNOD
      IF (NF(I,J).EQ.0) GO TO 1050
      NF(I,J) = K
      K = K + 1
 1050 CONTINUE
 1060 CONTINUE
      TOTDOF = K - 1
      RETURN
      END
