      SUBROUTINE TRIM3(FUN, IFUN, DER, IDER, JDER, XI, ETA, ITEST)
      INTEGER IDER, IFUN, ITEST, JDER, IERROR, ERRMES
      DOUBLE PRECISION DER, ETA, FUN, XI, SRNAME,Y1,Y2
      DIMENSION DER(IDER,JDER), FUN(IFUN)
      DATA SRNAME /8H TRIM3  /
      IF(ITEST.EQ.-1) GO TO 999
      IERROR=0
      IF(IFUN.LT.3) IERROR=1
      IF(IDER.LT.2.OR.JDER.LT.3) IERROR=2
      Y1=1.0D0/DSQRT(3.0D0)*(XI-1.0D0)
      Y2=1.0D0/DSQRT(3.0D0)*(1.0D0-XI)
      IF((XI.LT.-0.5D0.OR.XI.GT.1.0D0).OR.
     *     (ETA.LT.Y1.OR.ETA.GT.Y2)) IERROR=3
      ITEST=ERRMES(ITEST,IERROR,SRNAME)
      IF(ITEST.NE.0) RETURN
999   FUN(1) = 1.0D0/3.0D0*(1.0D0+2.0D0*XI)
      FUN(2) = 1.0D0/3.0D0*(1.0D0-XI-DSQRT(3.0D0)*ETA)
      FUN(3) = 1.0D0/3.0D0*(1.0D0-XI+DSQRT(3.0D0)*ETA)
      DER(1,1) = 2.0D0/3.0D0
      DER(1,2) = -1.0D0/3.0D0
      DER(1,3) = -1.0D0/3.0D0
      DER(2,1) = 0.0D0
      DER(2,2) = -1.0D0/DSQRT(3.0D0)
      DER(2,3) = +1.0D0/DSQRT(3.0D0)
      RETURN
      END
