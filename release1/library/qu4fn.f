      SUBROUTINE QU4FN(FUN, IFUN, DER, IDER, JDER, XI, ETA, ITEST)
      INTEGER IDER, IFUN, ITEST, JDER,IERROR,ERRMES
      DOUBLE PRECISION DER, ETA, ETAM, ETAP, FUN, XI, XIM,
     *     XIP,SRNAME
      DIMENSION DER(IDER,JDER), FUN(IFUN)
      DATA SRNAME /8H QU4FN  /
      IF(ITEST.EQ.-1) GO TO 999
      IERROR=0
      IF(IFUN.LT.4) IERROR=1
      IF(IDER.LT.2.OR.JDER.LT.4) IERROR=2
      IF(DABS(XI).GT.1.0D0.OR.DABS(ETA).GT.1.0D0)
     *    IERROR=3
      ITEST=ERRMES(ITEST,IERROR,SRNAME)
      IF(ITEST.NE.0) RETURN
999   ETAM = 0.250D0*(1.0D0-ETA)
      ETAP = 0.250D0*(1.0D0+ETA)
      XIM = 0.250D0*(1.0D0-XI)
      XIP = 0.250D0*(1.0D0+XI)
      FUN(1) = 4.0D0*XIM*ETAM
      FUN(2) = 4.0D0*XIM*ETAP
      FUN(3) = 4.0D0*XIP*ETAP
      FUN(4) = 4.0D0*XIP*ETAM
      DER(1,1) = -ETAM
      DER(1,2) = -ETAP
      DER(1,3) = ETAP
      DER(1,4) = ETAM
      DER(2,1) = -XIM
      DER(2,2) = XIM
      DER(2,3) = XIP
      DER(2,4) = -XIP
      RETURN
      END
